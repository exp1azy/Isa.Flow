function sendActorsAndQueuesStateRequest(){$.ajax({url:"/Home/GetState",type:"GET",dataType:"json",success:function(n){if(n!=null){var p=$("#newQueueCount"),b=$("#declareNewQueue"),d=$("#newUpdatedQueue");if(n.newCount!=null)b.css("display","none"),d.text(n.newAndUpdatedQueueName),p.text(n.newCount),p.show();else{p.css("display","none");b.show();$(document).on("click","#declareNewQueue",function(){$("#declareNewQueueForm").modal("show")})}var w=$("#deletedQueueCount"),k=$("#declareDeletedQueue"),g=$("#deletedQueue");if(n.deletedCount!=null)k.css("display","none"),g.text(n.deletedQueueName),w.text(n.deletedCount),w.show();else{w.css("display","none");k.show();$(document).on("click","#declareDeletedQueue",function(){$("#declareDeletedQueueForm").modal("show")})}var l=$("#extractorBlock"),u=$("#buttonNew"),f=$("#buttonUpd"),e=$("#buttonDel"),c=$("#openModal");n.extractorStarted!=null?(l.removeClass("isa-main-extractor-none"),l.addClass("isa-main-extractor"),c.removeClass("isa-start-ex-download"),c.addClass("isa-start-ex"),c.removeAttr("disabled"),c.text("Запустить"),n.extractorStarted.lastArticleId!=currentLastArticleId&&(currentLastArticleId=n.extractorStarted.lastArticleId,$("#lastArticleIdState").text("LastArticleId: "+currentLastArticleId),addLabelAndInputForNew()),n.extractorStarted.newState?(u.removeClass("isa-main-progress-func-off"),u.addClass("isa-main-progress-func-on"),u.removeAttr("disabled"),u.text("NEW Активно")):(u.removeClass("isa-main-progress-func-on"),u.addClass("isa-main-progress-func-off"),u.attr("disabled",!0),u.text("NEW Не активно")),n.extractorStarted.modifiedState?(f.removeClass("isa-main-progress-func-off"),f.addClass("isa-main-progress-func-on"),f.removeAttr("disabled"),f.text("UPDATED Активно")):(f.removeClass("isa-main-progress-func-on"),f.addClass("isa-main-progress-func-off"),f.attr("disabled",!0),f.text("UPDATED Не активно")),n.extractorStarted.deletedState?(e.removeClass("isa-main-progress-func-off"),e.addClass("isa-main-progress-func-on"),e.removeAttr("disabled"),e.text("DELETED Активно")):(e.removeClass("isa-main-progress-func-on"),e.addClass("isa-main-progress-func-off"),e.attr("disabled",!0),e.text("DELETED Не активно"))):(l.removeClass("isa-main-extractor"),l.addClass("isa-main-extractor-none"),u.removeClass("isa-main-progress-func-on"),u.addClass("isa-main-progress-func-off"),u.attr("disabled",!0),u.text("NEW Не активно"),f.removeClass("isa-main-progress-func-on"),f.addClass("isa-main-progress-func-off"),f.attr("disabled",!0),f.text("UPDATED Не активно"),e.removeClass("isa-main-progress-func-on"),e.addClass("isa-main-progress-func-off"),e.attr("disabled",!0),e.text("DELETED Не активно"),c.removeClass("isa-start-ex"),c.addClass("isa-start-ex-download"),c.attr("disabled",!0),c.text("Недоступно"));var a=$("#indexerBlock"),o=$("#buttonIndex"),t=$("#indexSubmit");n.indexerStarted!=null?(a.removeClass("isa-main-indexer-none"),a.addClass("isa-main-indexer"),n.indexerStarted?(o.removeClass("isa-main-index-off"),o.addClass("isa-main-index-on"),o.removeAttr("disabled"),o.text("Активно"),t.removeClass("isa-index-start"),t.removeClass("isa-index-start-download"),t.addClass("isa-index-stop"),t.attr("disabled",!0),t.text("Запущено")):(o.removeClass("isa-main-index-on"),o.addClass("isa-main-index-off"),o.attr("disabled",!0),o.text("Не активно"),t.removeClass("isa-index-stop"),t.removeClass("isa-index-start-download"),t.addClass("isa-index-start"),t.removeAttr("disabled"),t.text("Запустить"))):(a.removeClass("isa-main-indexer"),a.addClass("isa-main-indexer-none"),o.removeClass("isa-main-index-on"),o.addClass("isa-main-index-off"),o.attr("disabled",!0),o.text("Не активно"),t.removeClass("isa-index-stop"),t.removeClass("isa-index-start"),t.addClass("isa-index-start-download"),t.attr("disabled",!0),t.text("Недоступно"));var v=$("#tgCollectorBlock"),s=$("#buttonTgCollector"),i=$("#tgCollectorSubmit");n.tgCollectorStarted!=null?(v.removeClass("isa-main-tgcollector-none"),v.addClass("isa-main-tgcollector"),n.collectorStarted?(s.removeClass("isa-main-tgcollector-off"),s.addClass("isa-main-tgcollector-on"),s.removeAttr("disabled"),s.text("Активно"),i.removeClass("isa-tgcollector-start"),i.removeClass("isa-tgcollector-start-download"),i.addClass("isa-tgcollector-stop"),i.attr("disabled",!0),i.text("Запущено")):(s.removeClass("isa-main-tgcollector-on"),s.addClass("isa-main-tgcollector-off"),s.attr("disabled",!0),s.text("Не активно"),i.removeClass("isa-tgcollector-stop"),i.removeClass("isa-tgcollector-start-download"),i.addClass("isa-tgcollector-start"),i.removeAttr("disabled"),i.text("Запустить"))):(v.removeClass("isa-main-tgcollector"),v.addClass("isa-main-tgcollector-none"),s.removeClass("isa-main-tgcollector-on"),s.addClass("isa-main-tgcollector-off"),s.attr("disabled",!0),s.text("Не активно"),i.removeClass("isa-tgcollector-stop"),i.removeClass("isa-tgcollector-start"),i.addClass("isa-tgcollector-start-download"),i.attr("disabled",!0),i.text("Недоступно"));var y=$("#vkCollectorBlock"),h=$("#buttonVkCollector"),r=$("#vkCollectorSubmit");n.vkCollectorStarted!=null?(y.removeClass("isa-main-vkcollector-none"),y.addClass("isa-main-vkcollector"),n.vkCollectorStarted?(h.removeClass("isa-main-vkcollector-off"),h.addClass("isa-main-vkcollector-on"),h.removeAttr("disabled"),h.text("Активно"),r.removeClass("isa-vkcollector-start"),r.removeClass("isa-vkcollector-start-download"),r.addClass("isa-vkcollector-stop"),r.attr("disabled",!0),r.text("Запущено")):(h.removeClass("isa-main-vkcollector-on"),h.addClass("isa-main-vkcollector-off"),h.attr("disabled",!0),h.text("Не активно"),r.removeClass("isa-vkcollector-stop"),r.removeClass("isa-vkcollector-start-download"),r.addClass("isa-vkcollector-start"),r.removeAttr("disabled"),r.text("Запустить"))):(y.removeClass("isa-main-vkcollector"),y.addClass("isa-main-vkcollector-none"),h.removeClass("isa-main-vkcollector-on"),h.addClass("isa-main-vkcollector-off"),h.attr("disabled",!0),h.text("Не активно"),r.removeClass("isa-vkcollector-stop"),r.removeClass("isa-vkcollector-start"),r.addClass("isa-vkcollector-start-download"),r.attr("disabled",!0),r.text("Недоступно"))}setTimeout(sendActorsAndQueuesStateRequest,timeoutValue)},error:function(n){console.log(n)}})}function startExtraction(){$.ajax({url:"/Home/StartExtraction",type:"POST",data:$("#extractionForm").serialize(),success:function(n){var t=null;n==="0"&&(t=$("#buttonNew"),t.text("NEW Активно"));n=="1"&&(t=$("#buttonUpd"),t.text("UPDATED Активно"));n=="2"&&(t=$("#buttonDel"),t.text("DELETED Активно"));n=="fromMoreThanTo"&&window.alert("From не может быть больше To");t.removeAttr("disabled");t.removeClass("isa-main-progress-func-off");t.addClass("isa-main-progress-func-on");$("#lastArticleForm").modal("hide")},error:function(n){console.error(n)}})}function startIndex(){$.ajax({url:"/Home/StartIndex",type:"POST",success:function(n){n==="indexing"&&($("#buttonIndex").removeAttr("disabled"),$("#buttonIndex").removeClass("isa-main-index-off"),$("#buttonIndex").addClass("isa-main-index-on"),$("#buttonIndex").text("Активно"),$("#indexSubmit").removeClass("isa-index-start"),$("#indexSubmit").addClass("isa-index-stop"),$("#indexSubmit").attr("disabled",!0),$("#indexSubmit").text("ЗАПУЩЕНО"))},error:function(n){console.error(n)}})}function startTgCollector(){$.ajax({url:"Home/StartTgCollection",type:"POST",success:function(n){n==="phoneNumberRequested"&&(window.location.href="/Home/ShowPhoneNumberForm");n==="verificationRequested"&&(window.location.href="/Home/ShowVerificationForm");n==="started"&&($("#buttonTgCollector").removeAttr("disabled"),$("#buttonTgCollector").removeClass("isa-main-tgcollector-off"),$("#buttonTgCollector").addClass("isa-main-tgcollector-on"),$("#buttonTgCollector").text("Активно"),$("#tgCollectorSubmit").removeClass("isa-tgcollector-start"),$("#tgCollectorSubmit").addClass("isa-tgcollector-stop"),$("#tgCollectorSubmit").attr("disabled",!0),$("#tgCollectorSubmit").text("Запущено"));n.startsWith("error:")&&alert("Ошибка авторизации: "+n.substring(6)+"\n\nПопробуйте еще раз\nПри неудачной попытке обратитесь к разработчику")},error:function(n){console.error(n)}})}function startVkCollector(){window.location.replace("/Home/StartVkCollection")}function stopVkCollection(){$.ajax({url:"/Home/StopVkCollection",type:"POST",success:function(){},error:function(n){console.error(n)}})}function stopTgCollection(){$.ajax({url:"/Home/StopTgCollection",type:"POST",success:function(){},error:function(n){console.error(n)}})}function stopIndex(){$.ajax({url:"Home/StopIndex",type:"POST",success:function(){},error:function(n){console.error(n)}})}function stopExtractionFunc(n){$.ajax({url:"Home/StopExtraction",type:"POST",data:{value:n},success:function(){},error:function(n){console.error(n)}})}function declareNewQueue(){$.ajax({url:"/Home/QueueDeclare",type:"POST",data:$("#newQueueForm").serialize(),success:function(n){var i,t;n!=null?window.alert(n):(i=$("#declareNewQueue"),i.css("display","none"),t=$("#newQueueCount"),t.text("0"),t.show(),$("#declareNewQueueForm").modal("hide"))},error:function(n){console.error(n)}})}function declareDeletedQueue(){$.ajax({url:"/Home/QueueDeclare",type:"POST",data:$("#deletedQueueForm").serialize(),success:function(n){var i,t;n!=null?window.alert(n):(i=$("#declareDeletedQueue"),i.css("display","none"),t=$("#deletedQueueCount"),t.text("0"),t.show(),$("#declareDeletedQueueForm").modal("hide"))},error:function(n){console.error(n)}})}function disableButton(n){$(n).removeClass("isa-main-progress-func-on");$(n).addClass("isa-main-progress-func-off");$(n).attr("disabled",!0);n.id=="buttonNew"&&(stopExtractionFunc(0),$(n).text("NEW Не активно"),option=$("#newOption"),option.show());n.id=="buttonUpd"&&(stopExtractionFunc(1),$(n).text("UPDATED Не активно"),option=$("#updOption"),option.show());n.id=="buttonDel"&&(stopExtractionFunc(2),$(n).text("DELETED Не активно"),option=$("#delOption"),option.show());n.id=="buttonIndex"&&(stopIndex(),$(n).text("Не активно"),$(n).attr("disabled"),$(n).removeClass("isa-main-index-on"),$(n).addClass("isa-main-index-off"),$("#indexSubmit").removeAttr("disabled"),$("#indexSubmit").removeClass("isa-index-stop"),$("#indexSubmit").addClass("isa-index-start"),$("#indexSubmit").text("Запустить"));n.id=="buttonTgCollector"&&(stopTgCollection(),$(n).text("Не активно"),$(n).attr("disabled"),$(n).removeClass("isa-main-tgcollector-on"),$(n).addClass("isa-main-tgcollector-off"),$("#tgCollectorSubmit").removeAttr("disabled"),$("#tgCollectorSubmit").removeClass("isa-tgcollector-stop"),$("#tgCollectorSubmit").addClass("isa-tgcollector-start"),$("#tgCollectorSubmit").text("Запустить"));n.id=="buttonVkCollector"&&(stopVkCollection(),$(n).text("Не активно"),$(n).attr("disabled"),$(n).removeClass("isa-main-vkcollector-on"),$(n).addClass("isa-main-vkcollector-off"),$("#vkCollectorSubmit").removeAttr("disabled"),$("#vkCollectorSubmit").removeClass("isa-vkcollector-stop"),$("#vkCollectorSubmit").addClass("isa-vkcollector-start"),$("#vkCollectorSubmit").text("Запустить"))}function addLabelAndInputForNew(){var t,n,i;removeLabelAndInputForNew();removeLabelAndInputForReAndCl();t=document.createElement("label");n=document.createElement("input");t.setAttribute("for","articleId");t.textContent="Id";n.setAttribute("name","ArticleId");n.setAttribute("id","articleId");n.setAttribute("value",currentLastArticleId);i=document.getElementById("modalBody");i.appendChild(t);i.appendChild(n)}function addLabelAndInputForReAndCl(){var n;removeLabelAndInputForReAndCl();removeLabelAndInputForNew();var r=document.createElement("label"),t=document.createElement("input"),u=document.createElement("label"),i=document.createElement("input");r.setAttribute("for","intervalFrom");r.textContent="From";t.setAttribute("name","From");t.setAttribute("id","intervalFrom");t.setAttribute("value","0");u.setAttribute("for","intervalTo");u.textContent="To";i.setAttribute("name","To");i.setAttribute("id","intervalTo");i.setAttribute("value","0");n=document.getElementById("modalBody");n.appendChild(r);n.appendChild(t);n.appendChild(u);n.appendChild(i)}function removeLabelAndInputForReAndCl(){var n=document.getElementById("modalBody"),t=document.querySelector("label[for='intervalFrom']"),i=document.getElementById("intervalFrom"),r=document.querySelector("label[for='intervalTo']"),u=document.getElementById("intervalTo");t&&i&&r&&u&&(n.removeChild(t),n.removeChild(i),n.removeChild(r),n.removeChild(u))}function removeLabelAndInputForNew(){var n=document.getElementById("modalBody"),t=document.querySelector("label[for='articleId']"),i=document.getElementById("articleId");t&&i&&(n.removeChild(t),n.removeChild(i))}var timeoutValue=document.getElementById("timeoutValue").value,currentLastArticleId=0,initialSelectedValue;setTimeout(sendActorsAndQueuesStateRequest,timeoutValue);$("#openModal").click(function(){$("#lastArticleForm").modal("show")});$("#declareNewQueue").click(function(){$("#declareNewQueueForm").modal("show")});$("#declareDeletedQueue").click(function(){$("#declareDeletedQueueForm").modal("show")});document.getElementById("func").addEventListener("change",function(){var n=this.value;n==="0"?addLabelAndInputForNew():n==="3"||n==="4"?addLabelAndInputForReAndCl():(removeLabelAndInputForNew(),removeLabelAndInputForReAndCl())});initialSelectedValue=document.getElementById("func").value;initialSelectedValue==="0"&&addLabelAndInputForNew();